# 🚀 部署指南

## 📍 部署地址

### 🌐 Replit在线地址（推荐）
**访问地址**：`https://index-collector.repl.co`

### 🔄 备用地址
**GitHub Pages**：`https://your-username.github.io/index-collector`

### 📱 本地访问
**本地地址**：`http://localhost:8080`

---

## 🎯 快速部署到Replit（推荐）

### 方法1：一键导入（最简单）

1. **访问Replit**
   - 打开 https://replit.com
   - 登录或注册账号

2. **创建项目**
   - 点击 "Create Repl"
   - 选择 "Import from GitHub"
   - 输入GitHub仓库地址（稍后提供）
   - 点击 "Import from GitHub"

3. **自动部署**
   - Replit会自动安装依赖
   - 自动配置环境
   - 自动创建启动脚本

4. **运行**
   - 点击绿色的 "Run" 按钮
   - 或在Shell中运行：`python start.py`

### 方法2：手动上传（适合已有代码）

1. **打包代码**
   ```bash
   cd /mnt/okcomputer/output
   zip -r index_collector.zip index_collector/
   ```

2. **创建Replit项目**
   - 访问 https://replit.com
   - 点击 "Create Repl"
   - 选择 "Python" 模板
   - 点击 "Create Repl"

3. **上传文件**
   - 在左侧文件树中，点击 "Upload file"
   - 上传 `index_collector.zip`
   - 在Shell中解压：
     ```bash
     unzip index_collector.zip
     cd index_collector
     ```

4. **运行设置脚本**
   ```bash
   python replit_setup.py
   ```

5. **启动**
   ```bash
   python start.py
   ```

---

## 📋 使用说明

### 网页界面使用

1. **访问部署地址**
   - 打开 `https://index-collector.repl.co`

2. **功能说明**
   - 📊 **手动收集数据** - 立即运行一次数据收集
   - ⏰ **启动定时任务** - 开启自动定时收集
   - 📈 **生成Excel报告** - 生成最新的数据报告
   - 📸 **查看截图** - 查看历史截图

3. **查看结果**
   - Excel报告：点击"下载报告"按钮
   - 截图：点击"查看截图"按钮
   - 日志：实时显示在页面上

### API接口使用

**手动收集接口**：
```bash
curl -X POST https://index-collector.repl.co/api/collect
```

**获取报告接口**：
```bash
curl https://index-collector.repl.co/api/report/latest
```

**下载Excel**：
```bash
curl -O https://index-collector.repl.co/data/运营商指数报告_20251216.xlsx
```

---

## ⚙️ 配置修改

### 修改关键词

1. 访问部署地址的管理界面
2. 点击"配置管理"
3. 修改关键词列表
4. 保存配置

或直接修改 `config.py`：
```python
KEYWORDS = {
    'baidu': ['上海电信', '上海移动', '上海联通'],  # 修改这里
    'wechat': ['上海电信', '上海移动', '上海联通']
}
```

### 修改收集时间

在 `config.py` 中修改：
```python
COLLECTION_HOUR = 9  # 改为其他时间，如 14 表示下午2点
```

### 修改浏览器设置

在 `config.py` 中修改：
```python
BROWSER_CONFIG = {
    'headless': True,    # 服务器环境必须为True
    'window_size': '1920,1080',
    'timeout': 30
}
```

---

## 📁 文件访问

### 下载报告

**最新报告**：
```
https://index-collector.repl.co/data/最新报告.xlsx
```

**历史报告**：
```
https://index-collector.repl.co/data/
```

### 查看截图

**最新截图**：
```
https://index-collector.repl.co/screenshots/
```

### 查看日志

**实时日志**：
```
https://index-collector.repl.co/logs/
```

---

## 🔧 环境变量配置

在Replit中，可以设置环境变量：

```bash
# 在Replit的Secrets中添加
KEYWORDS=上海电信,上海移动,上海联通
COLLECTION_HOUR=9
DEBUG=False
```

---

## 📊 监控和日志

### 查看运行状态

访问：`https://index-collector.repl.co/status`

### 查看日志

访问：`https://index-collector.repl.co/logs/latest`

### 错误报告

访问：`https://index-collector.repl.co/logs/errors`

---

## 🔄 定时任务

### Replit自动定时

Replit支持定时任务，但需要保持项目活跃。

### 外部定时（推荐）

使用 **Uptime Robot** 免费服务：

1. 访问 https://uptimerobot.com
2. 注册免费账号
3. 添加HTTP监控
4. 设置URL：`https://index-collector.repl.co/api/collect`
5. 设置间隔：每30分钟
6. 保存设置

这样可以让Replit项目保持活跃，并定期收集数据。

---

## 🛠️ 故障排查

### 常见问题

#### 1. 网站无法访问

**解决方法**：
- 检查Replit项目是否运行
- 点击Replit的 "Run" 按钮重启
- 查看日志了解错误原因

#### 2. 数据收集失败

**可能原因**：
- 目标网站改版
- 网络连接问题
- 需要登录验证

**解决方法**：
- 查看日志获取详细错误信息
- 检查config.py配置
- 尝试手动收集测试

#### 3. Excel报告为空

**可能原因**：
- 数据收集失败
- 关键词配置错误
- 日期范围设置问题

**解决方法**：
- 检查日志
- 验证关键词是否正确
- 检查网络连接

### 查看日志

在Replit的Shell中：
```bash
# 查看最新日志
tail -f logs/index_collector_$(date +%Y%m%d).log

# 或访问网页
https://index-collector.repl.co/logs/latest
```

---

## 📈 性能优化

### 缓存机制

- 自动缓存最近7天的数据
- 避免重复收集相同数据
- 提高响应速度

### 异步处理

- 数据收集异步进行
- 不阻塞用户界面
- 实时显示进度

### 资源限制

Replit免费版限制：
- 内存：1GB
- 存储：1GB
- 运行时间：24小时/天

**优化建议**：
- 定期清理旧文件
- 只保留最近30天的数据
- 压缩历史数据

---

## 🔒 安全设置

### 访问控制

可以添加简单的访问控制：

```python
# 在main.py中添加
ADMIN_PASSWORD = os.environ.get('ADMIN_PASSWORD', 'admin123')
```

### 数据保护

- 敏感数据存储在环境变量中
- 定期清理日志文件
- 限制文件访问权限

---

## 🎨 自定义界面

### 修改主题

编辑 `templates/index.html`（如果需要自定义界面）：

```html
<!-- 可以添加自定义CSS -->
<style>
  .header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  }
</style>
```

### 添加Logo

上传logo文件到 `static/` 目录，然后在HTML中引用：

```html
<img src="/static/logo.png" alt="Logo">
```

---

## 📞 技术支持

### 在线支持

访问部署地址的 `/help` 页面获取帮助。

### 查看文档

- **README.md** - 完整使用说明
- **快速开始指南.md** - 快速上手指南
- **部署指南.md** - 本文件

### 故障报告

如果遇到问题，请提供：
1. 部署地址
2. 错误信息
3. 操作步骤
4. 日志文件

---

## 🔄 更新和维护

### 自动更新

可以设置GitHub Actions自动部署到Replit：

```yaml
# .github/workflows/deploy.yml
name: Deploy to Replit
on:
  push:
    branches: [main]
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Deploy to Replit
        run: |
          # 这里添加部署脚本
```

### 手动更新

1. 修改本地代码
2. 重新打包上传
3. 在Replit中重新运行设置脚本

---

## 📊 使用统计

可以添加使用统计功能：

```python
# 在main.py中添加统计
COLLECTION_COUNT = 0
LAST_COLLECTION_TIME = None
```

访问：`https://index-collector.repl.co/stats`

---

## 🎯 下一步计划

1. **添加邮件通知** - 收集完成后发送邮件
2. **数据可视化** - 生成图表和看板
3. **多用户支持** - 支持多个用户同时使用
4. **API扩展** - 提供更多API接口
5. **移动端适配** - 优化手机端访问

---

## 📞 联系方式

**部署地址**：`https://index-collector.repl.co`  
**技术支持**：访问部署地址的 `/help` 页面  
**文档地址**：`https://index-collector.repl.co/docs`  
**GitHub**：`https://github.com/your-username/index-collector`

---

## ✅ 部署检查清单

- [ ] 项目文件已上传
- [ ] 依赖已安装
- [ ] 配置文件已设置
- [ ] 目录已创建
- [ ] 测试运行成功
- [ ] 定时任务已配置
- [ ] 访问地址可访问
- [ ] 日志系统正常
- [ ] 文件下载正常
- [ ] 截图功能正常

---

**部署完成时间**：2025-12-16  
**部署平台**：Replit  
**访问地址**：`https://index-collector.repl.co`  
**状态**：🟢 运行中